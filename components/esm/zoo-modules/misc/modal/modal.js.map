{"version":3,"file":"modal.js","sources":["../../../../../../src/zoo-modules/misc/modal/modal.js"],"sourcesContent":["import { CrossIcon } from '../../icon/cross-icon/cross-icon.js';\nimport { registerComponents } from '../../common/register-components.js';\n\n/**\n * @injectHTML\n */\nexport class Modal extends HTMLElement {\n\n\tconstructor() {\n\t\tsuper();\n\t\tregisterComponents(CrossIcon);\n\t\tthis.shadowRoot.querySelector('.close').addEventListener('click', () => this.closeModal());\n\n\t\tconst box = this.shadowRoot.querySelector('.box');\n\t\tthis.closeModalOnClickHandler = (clickEvent) => {\n\t\t\tif (clickEvent.target == box) this.closeModal();\n\t\t};\n\t\tbox.addEventListener('click', this.closeModalOnClickHandler);\n\n\t\t// https://github.com/HugoGiraudel/a11y-dialog/blob/main/a11y-dialog.js\n\t\tthis.focusableSelectors = [\n\t\t\t'a[href]:not([tabindex^=\"-\"]):not([inert])',\n\t\t\t'area[href]:not([tabindex^=\"-\"]):not([inert])',\n\t\t\t'input:not([disabled]):not([inert])',\n\t\t\t'select:not([disabled]):not([inert])',\n\t\t\t'textarea:not([disabled]):not([inert])',\n\t\t\t'button:not([disabled]):not([inert])',\n\t\t\t'iframe:not([tabindex^=\"-\"]):not([inert])',\n\t\t\t'audio[controls]:not([tabindex^=\"-\"]):not([inert])',\n\t\t\t'video[controls]:not([tabindex^=\"-\"]):not([inert])',\n\t\t\t'[contenteditable]:not([tabindex^=\"-\"]):not([inert])',\n\t\t\t'[tabindex]:not([tabindex^=\"-\"]):not([inert])',\n\t\t];\n\n\t\tthis.keyUpEventHandler = (event) => {\n\t\t\tif (event.key === 'Escape') this.closeModal();\n\t\t\tif (event.key === 'Tab') this.maintainFocus(event.shiftKey);\n\t\t};\n\t}\n\n\tconnectedCallback() {\n\t\tthis.hidden = true;\n\t}\n\n\tstatic get observedAttributes() {\n\t\treturn ['closelabel', 'button-closeable'];\n\t}\n\n\tattributeChangedCallback(attrName, oldVal, newVal) {\n\t\tif (attrName === 'button-closeable') {\n\t\t\tif (this.hasAttribute('button-closeable')) {\n\t\t\t\tconst box = this.shadowRoot.querySelector('.box');\n\t\t\t\tbox.removeEventListener('click', this.closeModalOnClickHandler);\n\t\t\t} else {\n\t\t\t\tthis.shadowRoot.querySelector('.box').addEventListener('click', this.closeModalOnClickHandler);\n\t\t\t}\n\n\t\t} else if (attrName === 'closelabel') {\n\t\t\tthis.shadowRoot.querySelector('zoo-cross-icon').setAttribute('title', newVal);\n\t\t}\n\t}\n\n\topenModal() {\n\t\tthis.style.display = 'block';\n\t\tthis.toggleModalClass();\n\t\tthis.shadowRoot.querySelector('button').focus();\n\t\tdocument.addEventListener('keyup', this.keyUpEventHandler);\n\t}\n\n\tmaintainFocus(shiftKey) {\n\t\tconst button = this.shadowRoot.querySelector('button');\n\t\tconst slottedFocusableElements = [...this.querySelectorAll(this.focusableSelectors.join(','))];\n\t\tconst focusNotInSlotted = !slottedFocusableElements.some(el => el.isEqualNode(document.activeElement));\n\t\tconst focusNotInShadowRoot = !button.isEqualNode(this.shadowRoot.activeElement);\n\t\tif (focusNotInSlotted && focusNotInShadowRoot) {\n\t\t\tif (shiftKey) {\n\t\t\t\tslottedFocusableElements[slottedFocusableElements.length - 1].focus();\n\t\t\t} else {\n\t\t\t\tbutton.focus();\n\t\t\t}\n\t\t}\n\t}\n\n\tcloseModal() {\n\t\tif (this.timeoutVar) return;\n\t\tthis.hidden = !this.hidden;\n\t\tthis.toggleModalClass();\n\t\tthis.timeoutVar = setTimeout(() => {\n\t\t\tthis.style.display = 'none';\n\t\t\tthis.dispatchEvent(new Event('modalClosed'));\n\t\t\tthis.hidden = !this.hidden;\n\t\t\tthis.timeoutVar = undefined;\n\t\t}, 300);\n\t}\n\n\ttoggleModalClass() {\n\t\tconst modalBox = this.shadowRoot.querySelector('.box');\n\t\tif (!this.hidden) {\n\t\t\tmodalBox.classList.add('hide');\n\t\t\tmodalBox.classList.remove('show');\n\t\t} else {\n\t\t\tmodalBox.classList.add('show');\n\t\t\tmodalBox.classList.remove('hide');\n\t\t}\n\t}\n}\n\nif (!window.customElements.get('zoo-modal')) {\n\twindow.customElements.define('zoo-modal', Modal);\n}"],"names":[],"mappings":"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"}