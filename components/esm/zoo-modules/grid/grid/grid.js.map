{"version":3,"file":"grid.js","sources":["../../../../../../src/zoo-modules/grid/grid/grid.js"],"sourcesContent":["import { debounce } from '../../helpers/debounce.js';\nimport { Paginator } from '../../misc/paginator/paginator.js';\nimport { GridHeader } from '../grid-header/grid-header.js';\nimport { GridRow } from '../grid-row/grid-row.js';\nimport { registerComponents } from '../../common/register-components.js';\n/**\n * @injectHTML\n * https://github.com/whatwg/html/issues/6226\n * which leads to https://github.com/WICG/webcomponents/issues/59\n */\n\nexport class ZooGrid extends HTMLElement {\n\tconstructor() {\n\t\tsuper();\n\t\tregisterComponents(Paginator, GridHeader, GridRow);\n\t\tconst headerSlot = this.shadowRoot.querySelector('slot[name=\"headercell\"]');\n\t\theaderSlot.addEventListener('slotchange', debounce(() => {\n\t\t\tconst headers = headerSlot.assignedElements();\n\t\t\tthis.style.setProperty('--grid-column-num', headers.length);\n\t\t\theaders.forEach((header, i) => {\n\t\t\t\theader.setAttribute('column', i+1);\n\t\t\t\theader.setAttribute('role', 'columnheader');\n\t\t\t});\n\t\t\tif (this.hasAttribute('reorderable')) {\n\t\t\t\theaders.forEach(header => this.handleDraggableHeader(header));\n\t\t\t}\n\t\t\tif (this.hasAttribute('resizable')) {\n\t\t\t\tthis.handleResizableAttributeChange();\n\t\t\t}\n\t\t}));\n\t\tconst rowSlot = this.shadowRoot.querySelector('slot[name=\"row\"]');\n\t\trowSlot.addEventListener('slotchange', debounce(() => {\n\t\t\trowSlot.assignedElements().forEach(row => {\n\t\t\t\trow.setAttribute('role', 'row');\n\t\t\t\tif (row.tagName === 'ZOO-GRID-ROW') {\n\t\t\t\t\t[...row.querySelector('*[slot=\"row-details\"]').children].forEach((child, i) => {\n\t\t\t\t\t\tchild.setAttribute('column', i+1);\n\t\t\t\t\t\tchild.setAttribute('role', 'cell');\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t[...row.children].forEach((child, i) => {\n\t\t\t\t\t\tchild.setAttribute('column', i+1);\n\t\t\t\t\t\tchild.setAttribute('role', 'cell');\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}));\n\n\t\tthis.addEventListener('sortChange', e => {\n\t\t\tif (this.prevSortedHeader && !e.target.isEqualNode(this.prevSortedHeader)) {\n\t\t\t\tthis.prevSortedHeader.removeAttribute('sortstate');\n\t\t\t}\n\t\t\tthis.prevSortedHeader = e.target;\n\t\t});\n\t}\n\n\tstatic get observedAttributes() {\n\t\treturn ['currentpage', 'maxpages', 'resizable', 'reorderable', 'prev-page-title', 'next-page-title'];\n\t}\n\n\tattributeChangedCallback(attrName, oldVal, newVal) {\n\t\tif (attrName == 'resizable') {\n\t\t\tthis.handleResizableAttributeChange();\n\t\t} else if (attrName == 'reorderable' && this.hasAttribute('reorderable')) {\n\t\t\tthis.shadowRoot.querySelector('slot[name=\"headercell\"]').assignedElements().forEach(header => this.handleDraggableHeader(header));\n\t\t} else if (['maxpages', 'currentpage', 'prev-page-title', 'next-page-title'].includes(attrName)) {\n\t\t\tthis.shadowRoot.querySelector('zoo-paginator').setAttribute(attrName, newVal);\n\t\t}\n\t}\n\n\tresizeCallback(entries) {\n\t\tentries.forEach(entry => {\n\t\t\tconst columnNum = entry.target.getAttribute('column');\n\t\t\tconst width = entry.contentRect.width;\n\t\t\tconst columns = this.querySelectorAll(`[column=\"${columnNum}\"]`);\n\t\t\tcolumns.forEach(columnEl => columnEl.style.width = `${width}px`);\n\t\t});\n\t}\n\n\thandleResizableAttributeChange() {\n\t\tif (this.hasAttribute('resizable')) {\n\t\t\tthis.resizeObserver = this.resizeObserver || new ResizeObserver(debounce(this.resizeCallback.bind(this)));\n\t\t\tthis.shadowRoot.querySelector('slot[name=\"headercell\"]').assignedElements().forEach(header => this.resizeObserver.observe(header));\n\t\t}\n\t}\n\n\thandleDraggableHeader(header) {\n\t\t// avoid attaching multiple eventListeners to the same element\n\t\tif (header.hasAttribute('reorderable')) return;\n\t\theader.setAttribute('reorderable', '');\n\t\theader.setAttribute('ondragover', 'event.preventDefault()');\n\t\theader.setAttribute('ondrop', 'event.preventDefault()');\n\n\t\theader.addEventListener('dragstart', e => e.dataTransfer.setData('text/plain', header.getAttribute('column')));\n\t\t// drag enter fires before dragleave, so stagger this function\n\t\theader.addEventListener('dragenter', debounce(() => {\n\t\t\theader.classList.add('drag-over');\n\t\t\tthis.prevDraggedOverHeader = header;\n\t\t}));\n\t\theader.addEventListener('dragleave', () => header.classList.remove('drag-over'));\n\t\theader.addEventListener('drop', e => this.handleDrop(e));\n\t}\n\n\thandleDrop(e) {\n\t\tthis.prevDraggedOverHeader && this.prevDraggedOverHeader.classList.remove('drag-over');\n\t\tconst sourceColumn = e.dataTransfer.getData('text');\n\t\tconst targetColumn = e.target.getAttribute('column');\n\t\tif (targetColumn == sourceColumn) return;\n\t\t// move columns\n\t\tthis.querySelectorAll(`[column=\"${sourceColumn}\"]`).forEach(source => {\n\t\t\tconst target = source.parentElement.querySelector(`[column=\"${targetColumn}\"]`);\n\t\t\ttargetColumn > sourceColumn ? target.after(source) : target.before(source);\n\t\t});\n\t\t// reassign indexes for row cells\n\t\tthis.shadowRoot.querySelector('slot[name=\"row\"]').assignedElements()\n\t\t\t.forEach(row => {\n\t\t\t\tif (row.tagName === 'ZOO-GRID-ROW') {\n\t\t\t\t\t[...row.shadowRoot.querySelector('slot[name=\"row-details\"]').assignedElements()[0].children]\n\t\t\t\t\t\t.forEach((child, i) => child.setAttribute('column', i+1));\n\t\t\t\t} else {\n\t\t\t\t\t[...row.children].forEach((child, i) => child.setAttribute('column', i+1));\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tdisconnectedCallback() {\n\t\tif (this.resizeObserver) {\n\t\t\tthis.resizeObserver.disconnect();\n\t\t}\n\t}\n}\n\nif (!window.customElements.get('zoo-grid')) {\n\twindow.customElements.define('zoo-grid', ZooGrid);\n}"],"names":[],"mappings":"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"}